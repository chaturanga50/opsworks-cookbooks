#!/bin/bash

URL="<%= @url %>"
DIR="/tmp"
DOC_ROOT="<%= @document_root %>"

s3_bucket_name=$(echo "$URL" | awk -F '/' '{print $4}')
s3_env_name/=$(echo "$URL" | awk -F '/' '{print $5}')
s3_file_name=$(echo "$URL" | awk -F '/' '{print $6}')

echo "downloading file..."
cd $DIR
aws s3 cp s3://$s3_bucket_name/$s3_env_name/$s3_file_name .

echo "extract file to document_root"
mkdir $DOC_ROOT/current/ -p
cp $DIR/$s3_file_name $DOC_ROOT/current/
cd $DOC_ROOT/current/
if [[ $s3_file_name =~ \.tar$ ]];
then
    echo "this is tar file"
    tar -xf $s3_file_name
else
    echo "this is not tar file"
fi